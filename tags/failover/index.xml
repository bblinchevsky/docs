<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>– failover</title><link>https://trustgrid.github.io/docs/tags/failover/</link><description>Recent content in failover on</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://trustgrid.github.io/docs/tags/failover/index.xml" rel="self" type="application/rss+xml"/><item><title>Tutorials: Site Failover</title><link>https://trustgrid.github.io/docs/tutorials/operations-runbook/site-failover/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://trustgrid.github.io/docs/tutorials/operations-runbook/site-failover/</guid><description>
&lt;div class="pageinfo pageinfo-primary">
&lt;p>The below processes should be used to move traffic between sites in event of a complete site down scenario. This is handled by the Virtual Network Route Table.&lt;/p>
&lt;/div>
&lt;div class="alert alert-primary" role="alert">
In the examples below, xxxEdgeCluster is the primary site and xxx-edge3 is the secondary/disaster recovery site.
&lt;/div>
&lt;h3 id="manual-failover">Manual Failover&lt;/h3>
&lt;p>When a customer has selected manual failover, a portal user will need to adjust the destination of all &lt;a href="https://trustgrid.github.io/docs/docs/domain/virtual-networks/routes/">routes&lt;/a> currently pointed at the failed site.&lt;/p>
&lt;h4 id="failing-over">Failing Over&lt;/h4>
&lt;blockquote>
&lt;p>There will usually be &lt;a href="https://trustgrid.github.io/docs/docs/domain/virtual-networks/routes/">routes&lt;/a> for the &lt;a href="https://trustgrid.github.io/docs/docs/nodes/">nodes&amp;rsquo;&lt;/a> Virtual Management IP. These should not be changed in this process.&lt;/p>
&lt;/blockquote>
&lt;ol>
&lt;li>
&lt;p>In the portal, navigate to &lt;code>Domain&lt;/code> → &lt;code>Virtual Networks&lt;/code> and then select the appropriate Virtual network.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Select the &lt;code>Routes&lt;/code> panel from the left navigation bar.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Filter the route table either using the node/cluster names or network to be failed over (shown below).&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="route-table.png" alt="img">&lt;/p>
&lt;pre>&lt;code>a. If there is more than one network that needs to be routed to the secondary site using node/cluster names to filter is more efficient
&lt;/code>&lt;/pre>
&lt;ol>
&lt;li>Clear the destination field and start typing the name of the secondary site node/cluster. Select the appropriate node/cluster from the list.&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="destination-field.png" alt="img">&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Click &lt;code>Save&lt;/code>. Then select &lt;code>Review Changes&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>You should see a modified &lt;a href="https://trustgrid.github.io/docs/docs/domain/virtual-networks/routes/">route&lt;/a> for each network you adjusted showing the previous and current destination. If everything looks correct click &lt;code>Apply Changes&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="apply-changes.png" alt="img">&lt;/p>
&lt;ol>
&lt;li>It may take 1-2 minutes for nodes to pull down the updated routing table. Once that has completed any new flow or connection will automatically be sent to the new destination node.&lt;/li>
&lt;/ol>
&lt;div class="alert alert-primary" role="alert">
If the node/cluster is still online at the primary site, and there are existing flows/connections they will persist at that site. To clear them restart the active node at the primary site. See the last step in the Forcing Failover section below for instructions.
&lt;/div>
&lt;h4 id="failing-back">Failing Back&lt;/h4>
&lt;p>To send traffic back to the primary site reverse the changes in the routing performed during the failover.&lt;/p>
&lt;h3 id="automatic-failover">Automatic Failover&lt;/h3>
&lt;p>When a customer has selected automatic failover between sites there should be no intervention required if the primary site goes offline. The route table will be configured with multiple routes with different metrics. When determining where to send virtual traffic a node will select:&lt;/p>
&lt;ul>
&lt;li>The most specific route - meaning if there is a route for 192.168.100.1/32 and another for 192.168.100.0/24, the /32 route will be preferred&lt;/li>
&lt;li>With the lowest metric&lt;/li>
&lt;li>that is currently available - meaning this node has an active tunnel to the destination node/cluster&lt;/li>
&lt;/ul>
&lt;p>Below reflects a typical automatic failover configuration for a network&lt;/p>
&lt;h4 id="forcing-failover-or-prevent-auto-failback">Forcing Failover or Prevent Auto-Failback&lt;/h4>
&lt;p>If it is necessary to move traffic to the secondary site without the primary site going offline follow the below process.&lt;/p>
&lt;p>Also, if a failure of the primary site has occurred and you want to ensure traffic does not automatically return to that site if it comes online (e.g. it is unstable) you can follow the same process.&lt;/p>
&lt;ol>
&lt;li>
&lt;p>In the portal, navigate to &lt;code>Domain&lt;/code> → &lt;code>Virtual Networks&lt;/code> and then select the appropriate Virtual network.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Select &lt;code>Routes&lt;/code> from the left navigation bar.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Filter the route table either using the node/cluster names or network to be failed over (shown below)&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="route-table.png" alt="img">&lt;/p>
&lt;pre>&lt;code>a. If there is more than one network that needs to be routed to the secondary site using node/cluster names to filter is more efficient
&lt;/code>&lt;/pre>
&lt;ol>
&lt;li>Adjust the metric so that the primary site is a higher number than the secondary site. The maximum metric value is 200.&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="metric.png" alt="img">&lt;/p>
&lt;p>Click &lt;code>Save&lt;/code> and navigate to &lt;code>Review Changes&lt;/code>&lt;/p>
&lt;p>You should see a change like below for each route adjusted. Click &lt;code>Apply Changes&lt;/code> if all looks correct.&lt;/p>
&lt;p>&lt;img src="apply-changes-metric.png" alt="img">&lt;/p>
&lt;ol>
&lt;li>
&lt;p>It may take 1-2 minutes for nodes to pull down the updated route table. At that point, they will route new flows/connections to the new destination.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Because the primary site is still online, you will need to restart the active node at that site to clear out any existing flows/connections.&lt;/p>
&lt;p>a. If it&amp;rsquo;s a cluster, navigate to the cluster and then select the currently active node from the overview page. If a single node site, navigate directly to that node.&lt;/p>
&lt;p>b. From the toolbar select &lt;code>Restart&lt;/code>&lt;/p>
&lt;p>c. Enter the node’s name and click &lt;code>confirm&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="restore-traffic-to-primary-site">Restore Traffic to Primary Site&lt;/h3>
&lt;p>To restore traffic to the primary site repeat the above steps but set the route for the primary site to have the lowest metric.&lt;/p></description></item></channel></rss>